<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>账户</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <style type="text/css">
        .account-header {
            width: 100%;
            padding: 0.2rem 0rem;
            height: auto;
        }

        .account-header img {
            width: 5rem;
            height: 5rem;
            border-radius: 50%;
            margin: auto;
        }

        .account-name .account-name-span {
            margin: auto;
            font-size: 1.2rem;
        }

        .account-name .account-name-samll-span {
            font-size: 0.6rem;
        }

        .account-type p {
            margin: auto;
        }

        .account-type p span:last-child {
            color: #73C0B6;
        }
        /*.account-type span:last-child{
          text-align: left;
        }*/

        .aui-content .aui-list .aui-list-item {
            border-top: none;
            border-bottom: none;
        }

        .aui-list-item-inner {
            border: none;
        }

        .aui-list.aui-list-in .aui-list-item-inner:after {
            width: 100%;
            height: 1px;
            background-color: #fff;
            display: block;
            content: '';
            position: absolute;
            top: auto;
            right: auto;
            bottom: 0;
            left: 0;
            -webkit-transform-origin: 50% 100%;
            transform-origin: 50% 100%;
        }

        .aui-list:after {
            height: 1px;
            background-color: #fff;
            display: block;
            content: '';
            position: absolute;
            top: auto;
            right: auto;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 2;
            -webkit-transform-origin: 50% 100%;
            transform-origin: 50% 100%;
            pointer-events: none;
        }
        .aui-list:before {
            height: 1px;
            background-color: #fff;
            display: block;
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: auto;
            bottom: auto;
            width: 100%;
            z-index: 2;
            -webkit-transform-origin: 50% 100%;
            transform-origin: 50% 100%;
            pointer-events: none;
        }
        .diy-list .diy-list-span span:first-child {
            width: 1.5rem;
        }
    </style>
</head>

<body>
    <header id="header"></header>
    <div class="aui-content aui-margin-b-15 diy-content">
        <ul class="aui-list aui-list-in">
            <li class="aui-list-item" onclick="openUserInfo();">
                <div class="aui-list-item-inner">
                    <div class="account-header"><img class="account-header" src="../../image/default_portrait.png" onerror="imgExists(this)" />
                        <div/>
                    </div>
            </li>
            <li class="aui-list-item" onclick="openUserInfo();">
                <div class="aui-list-item-inner account-name">
                    <span class="account-name-span"></span>
                </div>
            </li>
            <li class="aui-list-item" onclick="openUserInfo();">
                <div class="aui-list-item-inner account-type">
                    <p><span class="i18n1" name="accounttype">账户类型</span>:<span class="account-type-span"></span></p>
                </div>
            </li>
            <li class="aui-list-item" onclick="openOrder();">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title diy-list">
                        <span class="diy-list-span"><span class="fa fa-credit-card"></span><span class="diy-list-span-in i18n1" name="order">订单</span></span>
                    </div>
                </div>
            </li>

            <li class="aui-list-item" onclick="openSetting();">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title diy-list">
                        <span class="diy-list-span"><span class="fa fa-cog"></span><span class="diy-list-span-in i18n1" name="settings">设置</span></span>
                    </div>
                </div>
            </li>
            <li class="aui-list-item" onclick="openPersonalInformation();">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title diy-list">
                        <span class="diy-list-span"><span class="fa fa-user-circle-o"></span><span class="diy-list-span-in i18n1" name="personalinformation">个人信息</span></span>
                    </div>
                </div>
            </li>
            <li class="aui-list-item" onclick="openBusinessInformation();">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title diy-list">
                        <span class="diy-list-span"><span class="fa fa-vcard"></span><span class="diy-list-span-in i18n1" name="businessinformation">商户信息</span></span>
                    </div>
                </div>
            </li>
            <li class="aui-list-item" onclick="openCustomerServicecCenter();">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title diy-list">
                        <span class="diy-list-span"><span class="fa fa-phone"></span><span class="diy-list-span-in i18n1" name="customerservice">客服</span></span>
                    </div>
                </div>
            </li>
            <li class="aui-list-item" onclick="requestSwitchAccounType();">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-title diy-list">
                        <span class="diy-list-span"><span class="fa fa-exchange"></span><span class="diy-list-span-in i18n1" name="switchingaccount">切换账户</span></span>
                    </div>
                </div>
            </li>
        </ul>
        </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script src="../../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../../script/language.js" type="text/javascript"></script>
<script type="text/javascript">
    var g_account, g_account_type, g_account_nickname, g_account_icon;
    apiready = function() {
            fnSettingHeader();
            loadAccountInfo();
            var data = api.pageParam;
            if (data != undefined) {
                g_account_type = data.account_type;
                if (g_account_type == "person_user") {
                    $('.account-type-span').text(GetTextByLanguage("普通用户", "Personal"));
                } else if (g_account_type == "company_user") {
                    $('.account-type-span').text(GetTextByLanguage("商户", "Merchant"));
                }
            }
            registerTouchEvent();
            hlLanguage("../../i18n/");
        }
        //打开账户窗体
    function openUserInfo() {
        api.openWin({
            name: 'account_profile',
            url: '../userinfo/account_profile.html',
            reload: true,
            pageParam: {
                g_account: g_account
            }
        });
        api.sendEvent({
            name: 'MaskClickEvent'
        });
    }
    //打开订单窗体
    function openOrder() {
        api.openWin({
            name: 'order',
            url: '../order/order.html',
            reload: true,
            pageParam: {
                account_type: g_account_type
            }
        });
        api.sendEvent({
            name: 'MaskClickEvent'
        });
    }
    //打开设置窗体
    function openSetting() {
        api.openWin({
            name: 'account_setting',
            url: '../setting/account_setting.html',
            reload: true,
            pageParam: {
                account_type: g_account_type
            }
        });
        api.sendEvent({
            name: 'MaskClickEvent'
        });
    }
    //打开个人信息窗体
    function openPersonalInformation() {
        api.openWin({
            name: 'person_profile',
            url: '../userinfo/person_profile.html',
            reload: true,
            pageParam: {}
        });
        api.sendEvent({
            name: 'MaskClickEvent'
        });
    }
    //打开商户信息窗体
    function openBusinessInformation() {
        api.openWin({
            name: 'company_profile',
            url: '../userinfo/company_profile.html',
            reload: true,
            pageParam: {}
        });
        api.sendEvent({
            name: 'MaskClickEvent'
        });
    }
    //打开客服窗体
    function openCustomerServicecCenter() {
        api.openWin({
            name: 'customer_service',
            url: '../customerservice/customer_service.html',
            reload: true,
            pageParam: {}
        });
        api.sendEvent({
            name: 'MaskClickEvent'
        });
    }
    //账户切换事件
    function requestSwitchAccounType() {
        if (g_account_type != undefined) {
            if (g_account_type == "person_user") {
                g_account_type = "company_user";
            } else if (g_account_type == "company_user") {
                g_account_type = "person_user";
            }
            api.sendEvent({
                name: 'SwitchAccountTypeEvent',
                extra: {
                    account_type: g_account_type
                }
            });
        } else {
            toastFail("切换失败,请稍后重试!");
        }
    }
    //监听页面滑动事件
    function registerTouchEvent() {
        $(document.body).on('touchstart', function(e) {
            //touchstart事件
            var $tb = $(this);
            var startX = (api.winWidth / 3) * 2, //手指触碰屏幕的x坐标
                pullDeltaX = 0;
            var x;
            $tb.on('touchmove', function(e) {
                x = e.touches[0].clientX; //手指移动后所在的坐标
                pullDeltaX = x - startX; //移动后的位移
                if (!pullDeltaX) {
                    return;
                }
                // console.log(Math.abs(pullDeltaX));
                // if (pullDeltaX <= 0 && Math.abs(pullDeltaX) > 40) {
                //     api.setFrameAttr({
                //         name: 'account',
                //         bounces: false,
                //         rect: {
                //             x: pullDeltaX,
                //             y: 0,
                //             w: api.winWidth - api.winWidth / 3 + pullDeltaX,
                //             h: api.winHeight
                //         }
                //     });
                // }
                e.preventDefault(); //阻止手机浏览器默认事件
            });
            $tb.on('touchend', function(e) {
                if (pullDeltaX < -30) {
                    //左滑，往后翻所执行的代码
                    api.closeFrame({
                        name: 'account'
                    });
                    api.closeFrame({
                        name: 'mask'
                    });
                } else {
                    api.setFrameAttr({
                        name: 'account',
                        bounces: false,
                        rect: {
                            x: 0,
                            y: 0,
                            w: api.winWidth - api.winWidth / 3,
                            h: api.winHeight
                        }
                    });
                }
            });
        });
    }
    //加载账户信息
    function loadAccountInfo() {
        //先判断本地是否是否存在
        try {
            var account = getAccount();
            if (account != undefined) {
                g_account = account;
                g_account_nickname = account.nickname;
                g_account_icon = account.icon_url;
                setAccountInfo(g_account_icon, g_account_nickname);
            } else {
                var s = 'http://' + serverIP + '/AccountOperation/getAccountInfo.action';
                api.ajax({
                    url: s,
                    method: 'post',
                    timeout: 30,
                    dataType: 'json',
                    data: {}
                }, function(ret, err) {
                    if (ret) {
                        if (ret.success) {
                            g_account = ret.account;
                            g_account_nickname = ret.account.nickname;
                            g_account_icon = ret.account.icon_url;
                        } else {
                            toastFail(ret.message);
                            if (ret.relogin) {
                                api.sendEvent({
                                    name: 'reloginEvent'
                                });
                            }
                        }
                        setAccountInfo(g_account_icon, g_account_nickname);
                    } else {
                        toastFail('系统出错,错误码:' + err.code);
                    }
                });
            }
        } catch (e) {
            toastFail('获取账户信息异常,请刷新重试!');
        }
    }
    //设置账户界面信息
    function setAccountInfo(g_account_icon, g_account_nickname) {
        if (g_account_icon != undefined && g_account_icon != "") {
            var url = 'http://' + serverIP + '/upload/pictures/' + g_account_icon;
            $('.account-header').attr('src', url);
        }
        if (g_account_nickname != undefined && g_account_nickname != "") {
            $('.account-name-span').removeClass('account-name-samll-span');
            $('.account-name-span').text(g_account_nickname);
        } else {
            $('.account-name-span').text('点击修改昵称吧!');
            $('.account-name-span').addClass('account-name-samll-span');
        }
    }
</script>

</html>
