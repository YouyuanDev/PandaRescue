<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>Order Status</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../css/font-awesome.min.css" />
    <style type="text/css">
        html,
        body {
            height: 100%;
        }

        .container {
            height: 100%;
            width: 100%;
            padding: 5px;
        }

        .order-status {
            background-color: #fff;
            color: #595959;
            border-radius: 3px 3px 0px 0px;
        }

        .cancel-order {
            border-radius: 0px 0px 3px 3px;
        }

        .item-container {
            height: auto;
        }

        .item-icon {
            border-radius: 50%;
        }

        .item-right {
            padding-left: 8px;
        }

        .item-color {
            color: #CCCCCC;
        }

        .item-fee {
            font-size: 2rem;
        }

        .item-fee-container {
            background-color: #fff;
        }

        .item-fee-container span {
            color: #000;
        }
    </style>
</head>

<body class="pr-body-bgcolor">
    <div class="aui-content container">
        <div class="aui-list aui-media-list aui-list-noborder">
            <div class="aui-list-item item-container">
                <div class="aui-media-list-item-inner">
                    <div class="aui-list-item-media item-icon-container">
                        <img src="../../image/default_portrait.png" class="item-icon" onerror="imgExists(this)">
                    </div>
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-text">
                            <div class="aui-list-item-title item-name"></div>
                        </div>
                        <div class="aui-list-item-text item-address">

                        </div>
                        <div class="aui-list-item-text item-service-type">

                        </div>
                        <div class="aui-list-item-text item-failure-type">

                        </div>
                        <!-- <div class="aui-list-item-text">
                            <p><span onclick="sendMessage();" class="fa fa-commenting item-message"></span><span onclick="callUser(this);" data-phone="" class="fa fa-phone item-phone"></span></p>
                        </div> -->
                    </div>
                </div>
                <div class="aui-info" style="padding-top:0">
                    <div class="aui-info-item item-time">
                    </div>
                </div>
            </div>
            <div class="aui-bar aui-bar-nav item-fee-container">
                <span><span class="item-fee"></span><span>元</span></span>
            </div>
            <div class="aui-bar aui-bar-nav cancel-order buttons pr-bgcolor">
                <div class="aui-btn aui-btn-block cancel-order i18n1" name="evaluate" onclick="evaluateCompany();">立即评价</div>
            </div>
        </div>
    </div>
    <!-- </div> -->
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/language.js"></script>
<script type="text/javascript">
    var g_order_no, g_account_type,g_account_type,g_person_user_no,g_comany_no;
    apiready = function() {
            var data = api.pageParam;
            var order = data.order;
            if (order != undefined) {
                g_order_no = order.order_no;
                g_account_type = data.account_type;
                g_account_type = data.account_type;
                g_person_user_no=data.person_user_no;
                g_comany_no=data.company_no;
                //如果传过来的账户类型不存在，或者账户类型为person，则不显示评价按钮
                if (g_account_type == undefined || g_account_type == "company_user") {
                    $('.buttons').hide();
                }
                var upload_files = order.upload_files;
                var icon_url;
                if (upload_files != undefined && upload_files != "") {
                    var arr = upload_files.split(';');
                    if (arr.length > 0 && arr[0] != undefined) {
                        icon_url = arr[0];
                    }
                }
                var company_name = order.company_name;
                var company_address = order.address;
                var fee = order.service_fee;
                var time = getDate1(order.order_time);
                var service_type = order.service_type;
                var failure_type = order.failure_type;
                $('.item-icon').attr('src', icon_url);
                if (company_name != undefined)
                    $('.item-name').text(company_name);
                if (company_address != undefined)
                    $('.item-address').text(company_address);
                if (service_type != undefined) {
                    $('.item-service-type').text(service_type);
                }
                if (failure_type != undefined) {
                    $('.item-failure-type').text(failure_type);
                }
                if (time != undefined) {
                    $('.item-time').text(time);
                }
                if (fee != undefined) {
                    $('.item-fee').text(fee);
                }
                setFrameHeight();
            } else {
                api.closeFrame({
                    name: 'order_detail_frame'
                });
            }
        }
        //设置Frame高度自适应
    function setFrameHeight() {
        var h = $('.container')[0].scrollHeight;
        api.setFrameAttr({
            name: 'order_detail_frame',
            rect: {
                x: 0,
                y: api.winHeight - h - 10,
                w: api.winWidth - 20,
                h: 'auto',
                marginLeft: 10,
                marginBottom: 10,
                marginRight: 10
            },
        });
    }
    //评价商户
    function evaluateCompany() {
        if (g_order_no != undefined) {
            //先查看订单是否已经评价，如果已经评价则打出评价信息
            api.openFrame({
                name: 'order_evaluate_frame',
                url: './order_evaluate_frame.html',
                reload: true,
                pageParam: {
                    order_no: g_order_no,
                    person_user_no:g_person_user_no,
                    company_no:g_comany_no
                },
                rect: {
                    x: 0,
                    y: api.winHeight - 280,
                    w: api.winWidth,
                    h: 'auto',
                },
                bounces: false
            });
            api.setFrameAttr({
                name: 'order_detail_frame',
                hidden: true
            });
        } else {
            toastFail("系统繁忙,请稍后评价!");
        }
    }

</script>

</html>
