<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>Order Status</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <link rel="stylesheet" type="text/css" href="../../css/font-awesome.min.css" />
    <style type="text/css">
        html,
        body {
            height: 100%;
        }

        .container {
            height: auto;
            width: 100%;
        }

        .aui-bar {
            background-color: #fff;
        }

        .aui-list.aui-list-in .aui-list-item-inner:after {
            width: 100%;
            height: 1px;
            background-color: #fff;
            display: block;
            content: '';
            position: absolute;
            top: auto;
            right: auto;
            bottom: 0;
            left: 0;
            -webkit-transform-origin: 50% 100%;
            transform-origin: 50% 100%;
        }

        .aui-list .item-title {
            width: 100%;
            padding-top: 5px;
            padding-bottom: 5px;
            text-align: center;
        }

        .star {
            padding-left: 0.2rem;
            padding-right: 0.2rem;
        }

        .item-content {
            padding-top: 3px;
            padding-bottom: 3px;
            border: 1px solid #A7A9A9;
            border-radius: 0.1rem;
            width: 80%;
            margin: auto;
        }

        .item-content-select {
            border: 1px solid #FF8C69;
            color: #FF8C69;
        }

        .item-content-unselect {
            border: 1px solid #A7A9A9;
            color: #A7A9A9;
        }

        .item-title-textarea {
            padding-left: 15px;
            padding-right: 15px;
        }

        .item-textarea {
            border: 1px solid #A7A9A9;
            border-radius: 0.1rem;
        }

        .content-container {
            max-height: 80px;
            overflow-x: scroll;
        }
    </style>
</head>

<body class="pr-body-bgcolor">
    <div class="container">
        <header id="header" class="aui-bar aui-bar-nav aui-bar-light personal-header">
            <a class="aui-pull-left aui-btn" onclick="closeMyself();">
                <span class="fa fa-chevron-left pr-fontcolor2"></span>
            </a>
            <div class="aui-title pr-fontcolor2 i18n1" name="evaluate">评价</div>
        </header>
        <div class="aui-content">
            <div class="aui-list aui-list-in aui-list-noborder">
                <div class="aui-list-item">
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-title item-title">
                            <p>
                                <span class="fa fa-star fa-2x pr-fontcolor1 star" data-grade="1" onclick="evaluateGrade(this);"></span>
                                <span class="fa fa-star fa-2x pr-fontcolor1 star" data-grade="2" onclick="evaluateGrade(this);"></span>
                                <span class="fa fa-star fa-2x pr-fontcolor1 star" data-grade="3" onclick="evaluateGrade(this);"></span>
                                <span class="fa fa-star fa-2x pr-fontcolor1 star" data-grade="4" onclick="evaluateGrade(this);"></span>
                                <span class="fa fa-star fa-2x pr-fontcolor1 star" data-grade="5" onclick="evaluateGrade(this);"></span>
                            </p>
                            <p class="item-desc pr-fontcolor4">
                            </p>
                        </div>
                    </div>
                </div>

                <div class="aui-list-item item-content-container">
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-title item-title">
                            <div class="aui-row">
                                <div class="aui-row-padded content-container">
                                    <!-- <div class="aui-col-xs-6">
                                    <div class="item-content pr-fontcolor1" data-select="0" onclick="selectEvaluateContent(this)">及时到达</div>
                                </div>
                                <div class="aui-col-xs-6">
                                    <div class="item-content pr-fontcolor1" data-select="0" onclick="selectEvaluateContent(this)">态度友善</div>
                                </div>
                                <div class="aui-col-xs-6">
                                    <div class="item-content pr-fontcolor1" data-select="0" onclick="selectEvaluateContent(this)">价格公道</div>
                                </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="aui-list-item">
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-title item-title item-title-textarea">
                            <textarea placeholder="其他想说的(最多输入50个字)" class="item-textarea pr-body-bgcolor"></textarea>
                        </div>
                    </div>
                </div>
                <div class="aui-list-item">
                    <div class="aui-list-item-inner">
                        <div class="aui-list-item-title item-title">
                            <div class="aui-btn aui-btn-block i18n1" name="anonymoussubmit">匿名提交</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/language.js"></script>
<script type="text/javascript">
    var g_order_no;
    var g_winHeight;
    apiready = function() {
            var data = api.pageParam;
            var order = data.order;
            $('.item-content-container').hide();
            //makeContentTemplate(1);
            g_winHeight=api.winHeight;
            registerTextareaChange();
            //setFrameHeight();
        }
        //设置Frame高度自适应
    function setFrameHeight() {
        var h = $('.container')[0].scrollHeight;
        api.setFrameAttr({
            name: 'order_evaluate_frame',
            rect: {
                x: 0,
                y: g_winHeight- h,
                w: api.winWidth,
                h: 'auto',
            },
        });
    }
    //关闭当前Frame
    function closeMyself() {
        api.setFrameAttr({
            name: 'order_detail_frame',
            hidden: false
        });
        api.closeFrame({
            name: 'order_evaluate_frame'
        });

    }
    //评价等级
    function evaluateGrade(obj) {
        $('.item-content-container').show();
        var data_grade_str = $(obj).attr('data-grade');
        if (data_grade_str != undefined) {
            var data_grade = parseInt(data_grade_str);
            $('.item-desc').text(getGradeDesc(data_grade));
            $('.star').removeClass('pr-fontcolor3');
            $('.star').addClass('pr-fontcolor1');
            for (var i = 0; i < data_grade; i++) {
                $('.star').eq(i).addClass('pr-fontcolor3');
            }
        }
        setFrameHeight();
    }
    //评价等级描述
    function getGradeDesc(index) {
        if (index < 5) {
            makeContentTemplate(1);
        } else {
            makeContentTemplate(0);
        }
        var desc = "";
        switch (index) {
            case 1:
                desc = "非常不满意,各方面很差!";
                break;
            case 2:
                desc = "不满意,比较差!";
                break;
            case 3:
                desc = "一般,还需改善!";
                break;
            case 4:
                desc = "比较满意,仍可改善!";
                break;
            case 5:
                desc = "非常满意,无可挑剔!";
                break;
        }

        return desc;
    }
    //选择评价内容
    function selectEvaluateContent(obj) {
        var data_select = $(obj).attr('data-select');
        $(obj).removeClass('item-content-select');
        $(obj).removeClass('item-content-unselect');
        if (data_select == "0") { //选中
            $(obj).addClass('item-content-select');
            $(obj).attr('data-select', "1");
        } else { //取消选中
            $(obj).addClass('item-content-unselect');
            $(obj).attr('data-select', "0");
        }
    }
    //添加5星以下内容
    function makeContentTemplate(flag) {
        var goodArr = ["及时到达", "态度友善", "价格公道"];
        var badArr = ["服务晚点", "态度恶劣", "价格偏高", "欺瞒用户", "索要好评"];
        var template = "";
        $('.content-container').empty();
        if (flag == 0) {
            for (var i = 0; i < goodArr.length; i++) {
                template = '  <div class="aui-col-xs-6">' +
                    '  <div class="item-content pr-fontcolor1" data-select="0" onclick="selectEvaluateContent(this)">' + goodArr[i] + '</div>' +
                    '  </div>';
                $('.content-container').append(template);
            }
        } else if (flag == 1) {
            for (var i = 0; i < badArr.length; i++) {
                template = '<div class="aui-col-xs-6">' +
                    '  <div class="item-content pr-fontcolor1" data-select="0" onclick="selectEvaluateContent(this)">' + badArr[i] + '</div>' +
                    '  </div>';
                $('.content-container').append(template);
            }
        }
        //setFrameHeight();
    }
    //设置实时监听textarea输入字数
    function registerTextareaChange() {
        $('.item-textarea').mouseover(function() {
          var h=api.safeArea.top;
          console.log(h);
          api.setFrameAttr({
              name: 'order_evaluate_frame',
              rect: {
                  x: 0,
                  y: h,
                  w: api.winWidth,
                  h: 'auto',
              },
          });
        }).mouseout(function(){
          console.log('........................');
          setFrameHeight();
        });
        $('.item-textarea').bind('propertychange input', function() {
            var content = $('.item-textarea').val();
            var counter = $('.item-textarea').val().length;
            if (counter > 50) {
                content = content.substring(0, 50);
            }
            $('.item-textarea').val(content);
        });
    }
</script>

</html>
