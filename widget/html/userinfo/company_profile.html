<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>商户信息简介</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <link rel="stylesheet" type="text/css" href="../../css/aui.css" />
    <link rel="stylesheet" type="text/css" href="../../css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <style>

    </style>
</head>

<body class="pr-body-bgcolor">
    <header id="header" class="aui-bar aui-bar-nav prscue-bg pr-bgcolor">
        <a class="aui-pull-left aui-btn" onclick="closeWindow();">
            <span class="fa fa-chevron-left"></span>
        </a>
        <div class="aui-title pr-fontcolor i18n1" name="businessinformation">商户信息</div>
        <a class="aui-pull-right aui-btn">
            <span onclick="submitForm();" class="i18n1" name="confirm">完成</span>
        </a>
    </header>
    <div class="aui-content aui-margin-b-15">
        <ul class="aui-list aui-form-list">
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="contactname">
                        联系人姓名
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-contact-input" type="text" placeholder="联系人姓名">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="merchantname">
                        商户名称
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-name-input" type="text" placeholder="商户名称">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="merchanttaxnumber">
                        商户税号
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-tax-input" type="text" placeholder="商户税号">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="cellphoneno">
                        手机号
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-cellphone-input" type="tel" placeholder="手机号">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="telephone">
                        商户座机
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-phone-input" type="text" placeholder="商户座机">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="address">
                        商户地址
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-address-input" type="text" placeholder="商户地址">
                    </div>
                </div>
            </li>

            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="foundingtime">
                        成立时间
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-foundtime-input" readonly="readonly" type="text" placeholder="成立时间">
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <div class="aui-content aui-margin-b-15">
        <ul class="aui-list aui-form-list">
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="longitude">
                        经度
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-lon-input" type="text" placeholder="经度">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner">
                    <div class="aui-list-item-label i18n1" name="latitude">
                        纬度
                    </div>
                    <div class="aui-list-item-input">
                        <input class="company-lat-input" type="text" placeholder="纬度">
                    </div>
                </div>
            </li>
            <li class="aui-list-item">
                <div class="aui-list-item-inner aui-list-item-arrow" onclick="openCompanyAuthentication();">
                    <div class="aui-list-item-label i18n1" name="realnameauthentication">
                        实名认证
                    </div>
                    <div class="aui-list-item-input">
                        <span class="fa fa-check-circle-o"></span><span class="i18n1 company-certified" name="uncertified">未认证</span>
                    </div>
                </div>
            </li>
        </ul>
    </div>
    <div class="aui-content aui-margin-b-15">
        <div class="aui-btn aui-btn-block aui-btn-sm pr-fontcolor pr-bgcolor i18n1" name="autopositioning" onclick="openAutomaticPositioning();">自动定位</div>
    </div>
</body>

</html>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script src="../../script/jquery.i18n.properties-1.0.9.js" type="text/javascript"></script>
<script src="../../script/language.js" type="text/javascript"></script>
<script type="text/javascript">
    var g_id;
    var map;
    apiready = function() {
            fnSettingHeader();
            map = api.require('bMap');
            var data = api.pageParam;
            if (data != undefined) {
                loadCompanyInfo();
            }
            hlLanguage("../../i18n/");
        }
        //商户信息修改
    function submitForm() {
        if (g_id == undefined && g_id == "") {
            toastFail("系统繁忙,请稍后重试!");
            return;
        }
        var s = 'http://' + serverIP + '/CompanyUser/saveCompanyUserInfo.action';
        api.ajax({
            url: s,
            method: 'post',
            timeout: 30,
            dataType: 'json',
            data: {
                values: {
                    id: g_id,
                    company_name: $('.company-name-input').val(),
                    company_tax_code: $('.company-tax-input').val(),
                    company_location_lon: $('.company-lon-input').val(),
                    company_location_lat: $('.company-lat-input').val(),
                    contact_person: $('.company-contact-input').val(),
                    address: $('.company-address-input').val(),
                    lane_line: $('.company-phone-input').val(),
                    cell_phone: $('.person-cellphone-input').val()
                }
            }
        }, function(ret, err) {
            if (ret) {
                if (ret.success) {
                    toastSuccess(ret.message);
                } else {
                    toastFail(ret.message);
                }
            } else {
                toastFail('保存个人信息时出错,错误信息:' + err.code);
            }
        });
    }
    //加载商户信息
    function loadCompanyInfo() {
        openLoading();
        var s = 'http://' + serverIP + '/CompanyUser/getCompanyUserInfo.action';
        api.ajax({
            url: s,
            method: 'post',
            timeout: 30,
            dataType: 'json'
        }, function(ret, err) {
            if (ret) {
                var company_name, company_found_date, company_tax_code, company_location_lon, company_location_lat, contact_person, cell_phone, address, lane_line, is_verified;
                if (ret.success) {
                    g_id = ret.company.id;
                    company_name = ret.company.company_name;
                    company_tax_code = ret.company.company_tax_code;
                    company_location_lon = ret.company.company_location_lon;
                    company_location_lat = ret.company.company_location_lon;
                    contact_person = ret.company.contact_person;
                    cell_phone = ret.company.cell_phone;
                    address = ret.company.address;
                    lane_line = ret.company.lane_line;
                    is_verified = ret.company.is_verified;
                    company_found_date = ret.company.company_found_date;

                } else {
                    toastFail(ret.message);
                    if(ret.relogin){
                      api.sendEvent({
                          name: 'reloginEvent'
                      });
                    }
                }
                if (company_name != undefined && company_name != "") {
                    $('.company-name-input').val(company_name);
                }
                if (company_tax_code != undefined && company_tax_code != "") {
                    $('.company-tax-input').val(company_tax_code);
                }
                if (cell_phone != undefined && cell_phone != "") {
                    $('.company-cellphone-input').val(cell_phone);
                }
                if (contact_person != undefined && contact_person != "") {
                    $('.company-contact-input').val(contact_person);
                }
                if (address != undefined && address != "") {
                    $('.company-address-input').val(address);
                }
                if (lane_line != undefined && lane_line != "") {
                    $('.company-phone-input').val(lane_line);
                }
                if (company_location_lon != undefined && company_location_lon != "") {
                    $('.company-lon-input').val(company_location_lon);
                }
                if (company_location_lat != undefined && company_location_lat != "") {
                    $('.company-lat-input').val(company_location_lat);
                }
                if (company_found_date != undefined && company_found_date != "") {
                    $('.company-foundtime-input').val(getDate1(company_found_date));
                }

                if (is_verified != undefined && is_verified != "") {
                    if (is_verified == 0) {
                        $('.company-certified').text("未认证");
                    } else if (is_verified == 1) {
                        $('.company-certified').text("已认证");
                    }
                }
            } else {
                toastFail('获取商户信息时出错,错误信息:' + err.code);
            }
            closeLoading();
        });
    }
    //开启定位
    function openAutomaticPositioning() {
        map.getLocation({
            accuracy: '10m',
            autoStop: false,
            filter: 1
        }, function(ret, err) {
            if (ret.status) {
                 toastSuccess("定位成功!");
                 var lon=ret.lon;
                 var lat=ret.lat;
                 $('.company-lon-input').val(lon);
                 $('.company-lat-input').val(lat);
            } else {
                toastFail("定位错误,错误代码:"+err.code);
            }
        });
    }
    //打开商户认证通道
    function openCompanyAuthentication(){
      api.openFrame({
          name: 'company_authentication',
          url: '../authentication/company_authentication.html',
          rect: {
              x: 0,
              y: 0,
              w: api.winWidth,
              h: api.height
          },
          animation: {
              type: "push",
              subType: "from_right",
              duration: 300
          }
      });
    }
</script>
