<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>Hello APP</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css" />
    <style type="text/css">
        html,
        body {
            height: 100%;
        }
    </style>
</head>

<body class="wrap">
    <section class="flex-1">
        <div class="poilist-container">
            <div class="aui-content aui-margin-b-15">
                <ul id="poilist-ul" class="aui-list aui-list-in">

                </ul>
            </div>
        </div>
    </section>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../script/common.js"></script>
<script type="text/javascript">
    var company_data, map;
    apiready = function() {
            var data = api.pageParam
            company_data = data.company;
            map = api.require('bMap');
            showCompany();
        }
        //展示附近商户信息
    function showCompany() {
        if (company_data) {
            var template = "";
            for (var i = 0; i < company_data.length; i++) {
                template += (companyListTemplate(company_data[i].id, company_data[i].company_name, company_data[i].address));
                //setBubble(company_data[i].id, company_data[i].company_name);
            }
            $('#poilist-ul').append(template);
        }
    }
    //设置商户的Bubble
    // function setBubble(bubble_id, company_name) {
    //     map.setBubble({
    //         id: bubble_id,
    //         bgImg: 'widget://image/bubble_bg.png',
    //         content: {
    //             title: '',
    //             subTitle: company_name,
    //         },
    //         styles: {
    //             titleColor: '#000',
    //             titleSize: 16,
    //             subTitleColor: '#fff',
    //             subTitleSize: 12,
    //             illusAlign: 'left'
    //         }
    //     }, function(ret) {
    //         if (ret) {
    //             alert(JSON.stringify(ret));
    //         }
    //     });
    // }

    function popupBubble(obj) {
        var company_no = $(obj).attr('data-no');
        api.sendEvent({
            name: 'ClickCompanyListEventListener',
            extra: {
                company_no:company_no
            }
        });
    }
    //生成模板
    function companyListTemplate(company_no, company_name, company_address) {
        var template = '<li class="aui-list-item" data-no=' + company_no + ' onclick="popupBubble(this)">' +
            '<div class="aui-list-item-label-icon">' +
            '<i class="aui-iconfont aui-icon-home"></i>' +
            '</div>' +
            '<div class="aui-list-item-inner">' +
            '<div class="company-name">' + company_name + '</div>' +
            '<div class="company-address">' + company_address + '</div>' +
            '</div>' +
            '</li>';
        return template;
    }
    //
</script>

</html>
